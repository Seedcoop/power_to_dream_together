<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>좌표 그래프 계산기 (중등용)</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,sans-serif;background:#f9fafb;color:#111;margin:0}
  .container{max-width:1200px;margin:0 auto;padding:20px}
  h1{text-align:center;font-size:28px;font-weight:800;margin-bottom:20px}
  .grid{display:grid;gap:20px;grid-template-columns:1fr}
  @media(min-width:1000px){.grid{grid-template-columns:380px 1fr}}
  .card{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:16px}
  .btn{padding:10px;border:0;border-radius:10px;font-weight:700;cursor:pointer;margin-top:6px}
  .blue{background:#2563eb;color:#fff}
  .gray{background:#e5e7eb}
  .red{background:#dc2626;color:#fff}
  .green{background:#16a34a;color:#fff}
  .ghost{background:#eef2ff;color:#3730a3}
  input[type=number]{width:80px;padding:6px;border:1px solid #d1d5db;border-radius:6px}
  .row{display:flex;align-items:center;gap:6px;margin-bottom:8px}
  .trash{background:none;border:0;cursor:pointer;color:#dc2626;font-size:18px}
  .empty{display:flex;align-items:center;justify-content:center;height:360px;border:2px dashed #d1d5db;border-radius:12px;color:#6b7280}
  .svg{background:#fff;border:1px solid #d1d5db;border-radius:12px}
  .legend{display:flex;gap:14px;justify-content:center;margin-top:8px;font-size:14px}
  .dot{width:14px;height:14px;border-radius:50%}
  .line{width:20px;height:4px}
</style>
</head>
<body>
<div class="container">
  <h1>좌표 그래프 계산기</h1>
  <div class="grid">
    <!-- 입력 -->
    <div class="card">
      <h2>좌표 입력</h2>
      <div id="rows"></div>
      <button class="btn ghost" onclick="addRow()">➕ 좌표 추가</button>
      <div style="margin-top:12px;display:flex;flex-direction:column;gap:8px">
        <button id="showBtn" class="btn gray" onclick="togglePoints()">📊 값 표시하기</button>
        <button id="lineBtn" class="btn gray" onclick="toggleLine()" disabled>📈 그래프 그리기</button>
        <button id="predictBtn" class="btn gray" onclick="togglePredict()" disabled>🔮 원하는 값 구하기</button>
      </div>
      <div id="predictBox" style="display:none;margin-top:12px">
        <input type="number" id="predictX" placeholder="X 입력">
        <button class="btn green" onclick="predict()">계산</button>
        <div id="predictResult" style="margin-top:8px;font-weight:700"></div>
      </div>
    </div>

    <!-- 그래프 -->
    <div class="card">
      <h2>그래프</h2>
      <div id="blank" class="empty">좌표를 입력하고 [값 표시하기]를 누르세요</div>
      <svg id="svg" class="svg" width="600" height="400" style="display:none"></svg>
      <div class="legend">
        <div class="row"><span class="dot" style="background:#2563eb"></span>점</div>
        <div class="row"><span class="line" style="background:#dc2626"></span>추세선</div>
        <div class="row"><span class="dot" style="background:#16a34a"></span>예측</div>
      </div>
    </div>
  </div>
</div>

<script>
let points=[{id:1,x:'',y:''}], show=false, line=false, pred=null;

document.addEventListener('DOMContentLoaded',()=>render());

function render(){
  const box=document.getElementById('rows'); box.innerHTML='';
  points.forEach(p=>{
    box.innerHTML+=`
      <div class="row">
        #${p.id}
        <input type="number" value="${p.x}" placeholder="x" oninput="upd(${p.id},'x',this.value)">
        <input type="number" value="${p.y}" placeholder="y" oninput="upd(${p.id},'y',this.value)">
        ${points.length>1?`<button class="trash" onclick="del(${p.id})">🗑️</button>`:''}
      </div>`;
  });
  draw();
}

function addRow(){points.push({id:points.length+1,x:'',y:''});render();}
function del(id){points=points.filter(p=>p.id!==id);render();}
function upd(id,k,v){const p=points.find(p=>p.id===id);p[k]=v;draw();}
function valid(){return points.filter(p=>p.x&&p.y).map(p=>({x:+p.x,y:+p.y}));}

function togglePoints(){show=!show;if(!show){line=false;pred=null;}draw();}
function toggleLine(){if(valid().length<2)return alert("점이 2개 이상 필요");line=!line;if(line)show=true;draw();}
function togglePredict(){if(valid().length<2)return alert("점이 2개 이상 필요");const b=document.getElementById('predictBox');b.style.display=(b.style.display==='none')?'block':'none';}
function predict(){
  const pts=valid(),t=trend(pts);if(!t)return;
  const x=+document.getElementById('predictX').value;
  const y=t.a*x+t.b; pred={x,y};
  document.getElementById('predictResult').textContent=`예측: (${x}, ${y.toFixed(1)})`;
  draw();
}

function trend(pts){const n=pts.length,sx=pts.reduce((s,p)=>s+p.x,0),sy=pts.reduce((s,p)=>s+p.y,0),sxx=pts.reduce((s,p)=>s+p.x*p.x,0),sxy=pts.reduce((s,p)=>s+p.x*p.y,0);const d=n*sxx-sx*sx;if(!d)return null;const a=(n*sxy-sx*sy)/d,b=(sy-a*sx)/n;return{a,b};}

function draw(){
  const pts=valid(),svg=document.getElementById('svg'),blank=document.getElementById('blank');
  if(!show||pts.length===0){svg.style.display='none';blank.style.display='flex';return;}
  svg.style.display='block';blank.style.display='none';svg.innerHTML='';
  const W=600,H=400,P=50;
  let xs=pts.map(p=>p.x),ys=pts.map(p=>p.y);
  if(pred){xs.push(pred.x);ys.push(pred.y);}
  let minX=Math.min(...xs),maxX=Math.max(...xs),minY=Math.min(...ys),maxY=Math.max(...ys);
  const toX=x=>P+(x-minX)/(maxX-minX||1)*(W-2*P);
  const toY=y=>H-P-(y-minY)/(maxY-minY||1)*(H-2*P);
  // 축
  lineEl(P,P,P,H-P,'#333',2); lineEl(P,H-P,W-P,H-P,'#333',2);
  // 추세선
  if(line&&pts.length>=2){const t=trend(pts);if(t){const y1=t.a*minX+t.b,y2=t.a*maxX+t.b;lineEl(toX(minX),toY(y1),toX(maxX),toY(y2),'#dc2626',2);}}
  // 점
  pts.forEach(p=>{circleEl(toX(p.x),toY(p.y),6,'#2563eb');});
  // 예측
  if(pred){circleEl(toX(pred.x),toY(pred.y),7,'#16a34a');}
  function lineEl(x1,y1,x2,y2,c,w){const e=document.createElementNS('http://www.w3.org/2000/svg','line');e.setAttribute('x1',x1);e.setAttribute('y1',y1);e.setAttribute('x2',x2);e.setAttribute('y2',y2);e.setAttribute('stroke',c);e.setAttribute('stroke-width',w);svg.appendChild(e);}
  function circleEl(cx,cy,r,f){const e=document.createElementNS('http://www.w3.org/2000/svg','circle');e.setAttribute('cx',cx);e.setAttribute('cy',cy);e.setAttribute('r',r);e.setAttribute('fill',f);svg.appendChild(e);}
}
</script>
</body>
</html>
